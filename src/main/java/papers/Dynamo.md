# Dynamo - Amazon的高可用键值数据库

## 0.0 需求
- 永远可写，支持持久化
- 运行在磁盘，分布式存储系统
- 可以牺牲某些特定场景下的一致性
- TODO：对象版本化，应用协助的冲突解决

## 0.1 对比 Redis
- 应用场景，缓存或内存数据库
- 主要运行在内存里
- 单机 或 主从复制集群

## 1 简述
- 高度去中心化，松耦合，面向服务的架构
- 磁盘损坏，路由抖动，数据中心灾难时，用户仍然可以添加购物车
- 键值数据库，畅销榜，购物车，会话管理，用户偏好，商品目录
- 用一致性哈希来分区复制
- 用对象版本化实现一致性
- 用类仲裁技术和副本同步协议实现副本之间的一致性
- 基于Gossip协议实现故障检测和成员变更
- 无需人工分区或者节点数据重分布
- 每日几千万的购物车请求可以产生300万的付款操作
- 健壮的会话管理支持者每日几千万的活跃用户

## 2 背景
- 数据库的复制功能，用可用性换一致性
- TODO：数据库的水平扩展，智能分区
- TODO：一致性窗口
- 每个服务，使用一套Dynamo系统

## 2.1 假设
- 通过唯一的键进行读写，存储二进制对象，用键来索引
- 没有跨多个键的操作，没有数据模式，没有联合查询
- 存储的基本是小文件
- 数据仓库为了可用性牺牲了ACID
- Dynamo为了Availability牺牲了Consistency
- 运行在通用硬件上，但是达到P99.9的SLA

## 2.2 需求
- 复制式数据库用可用性换取强一致性
- 乐观复制增强了可用性，但是需要检测和解决冲突
- Dynamo 设计为 最终一致数据存储
- 传统数据库在写时解决冲突，读的时候比较方便，副本不能访问时写就会失败
- Dynamo 设计为永远可写，读数据的时候解决冲突
- 数据库可以解决冲突，然后用最后一次写有效的策略
- 或者有应用程序选择合并冲突的版本

## 0919

## Dynamo - Amazon的高可用键值数据库

## 2.3 其他设计
- 增量扩展，逐步扩容方便
- 对称性，每个节点职责等价，去中心化
- 异构性，负载的分布和节点性能成正比

## 3.1 点对点系统
- 第一代P2P，Freenet/Fnutella 不可信网络，随意建立节点之间的连接，泛洪查询
- 结构化P2P，全局一致性协议，任何节点高效地查询请求发送到节点，
- Pastry/Chord保证若干跳内能收到应答
- 每个节点维护足够多路由，还达到O(1)路由机制
- Oceanstore是一个全球分布式的，支持事务，持久，副本串行化更新

## 3.2 分布式文件系统和数据库 TODO
- P2P，扁平化；分布式,支持层级
- Ficus，Coda，多主，通过文件复制实现可用性，牺牲了一致性
- Farsite，无主分布式文件系统，通过复制来实现扩展性和高可用
- GFS，单主，数据分片到从节点
- Bayou 分布式关系型数据库，多主，提供最终一致性



















